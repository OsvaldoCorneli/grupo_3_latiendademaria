<html lang="es">
    <head>
        <%- include('../partials/head.ejs') %>
        <link href="\css\editForm.css" rel="stylesheet"/>
    </head>
<body>
    <%- include('../partials/navbar.ejs') %>
    <main class="createForm">
        <% if(message !== null){ %>
        <script>
            window.onload = function() {
                alert("Producto editado con exito");
            };
        </script>
        <%}%>
            <span class="titulo">
                <h1>Editar Producto</h1>
            </span>
            <!-- <strong>Formulario Editar producto</strong> -->
            <form class="form-producto" action="/products/<%= productEdit.id %>/edit?_method=PUT" method="POST" enctype="multipart/form-data">
                <input type="hidden" name="id" value="<%= productEdit.id %>"/>
                <span class="contenedor1">
                    <label for="name"><b>Nombre:</b></label>
                        <input class="inputForm" 
                        id="name" 
                        type="text" 
                        name="name" 
                        placeholder="Ingresar Nombre"
                        value="<%= productEdit.name %>" 
                        />
                    <% if (locals.errors && errors.name) { %>
                        <p class="errors"><%= errors.name.msg %></p>
                    <% } %>
                    <label for="description"><b>Descripcion:</b></label>
                        <textarea id="description" type="text" name="description" placeholder="Ingresar descripciÃ³n..."><%= productEdit.description %></textarea>
                    </label>
                    <% if (locals.errors && errors.description) { %>
                        <p class="errors"><%= errors.description.msg %></p>
                    <% } %>
                    <div class="inputform button-wrap">
                        <label class="button" for="imageinput">Subir Imagen
                            <input
                                class="uploadfile"
                                type="file" 
                                id="imageinput" 
                                name="image" 
                                accept="image/jpeg, image/png, image/jpg"
                                placeholder="Ingresar URL de imagen..."
                                multiple
                            />
                        </label>
                        <% if (locals.errors && errors.image) { %>
                            <p class="errors"><%= errors.image.msg %></p>
                        <% } %>
                    </div>
                    <span id="imageRender">
                        <% productEdit.images?.forEach((img, index) => { %>
                            <span class="imageHold">
                                <p><%= img.pathName.split('uploads')[1] %> ? KB</p>
                                <img src="<%= img.pathName %>" alt="<%= productEdit.name+index %>"/>
                                <input type="hidden" id="<%= img %>input" name="imageHold" value="<%= img.pathName %>"/>
                                <button id="deleteImageHold" class="deleteImage" value="<%= img.pathName %>">Borrar</button>
                            </span>
                        <% }) %>
                    </span>

                    <label for="line"><b>Linea:</b></label>
                    <select id="line" name="line">
                        <option value="sublimada" <%= productEdit.line === "sublimada" ? "selected" : null %>>Sublimada</option>
                        <option value="artesanal" <%= productEdit.line === "artesanal" ? "selected" : null %>>Artesanal</option>
                    </select>
                    <% if (locals.errors && errors.line) { %>
                        <p class="errors"><%= errors.line.msg %></p>
                    <% } %>
                    
                    <label for="category"><b>Categoria:</b>
                        <% categorias.forEach((category) => { %>
                                <input id="category" type="radio" name="category" value="<%= category.id %>" 
                                <% if (category.id == productEdit.categories.id) { %> <%= checked="checked" %> <% } %>>
                                <%= category.name %></input>
                        <% }) %>
                    </label>
                    <label for="color"><b>Colores:</b></label>
                    <div class="container-colorinputs">
                    <!-- <% if (typeof(productEdit.colors) == 'string') { let background=`color:${productEdit.colors.hex};`%>
                        <div>
                            <input class="c0" type="color" name="color" id="color" value="<%= productEdit.colors.hex %>"/>
                            <span id="c0" style=<%= background %>><%= productEdit.colors.name %></span>
                        </div>
                    <% } else { %> -->
                    <% productEdit.colors?.forEach(({stock, color},index) =>  { let background=`color:${color.hex};`%>
                        <div>
                            <input class="c<%= index %>" type="color" name="color" id="color" value="<%= color.hex %>"/>
                            <span id="c<%= index %>" style=<%= background %>><%= color.hex %></span>
                            <label for="stock">Stock:</label>
                            <input type="number" name="stock" value="<%= stock %>" required/>
                        </div>
                    <% })} %>
                        <span id="agregar" class="button">Agregar color</span>
                    </div>
                    <% if (locals.errors && errors.color) { %>
                        <p class="errors"><%= errors.color.msg %></p>
                    <% } %>
                    <label for="price"><b>Precio:</b></label>
                    <input class="inputForm" 
                        type="number"
                        id="price" 
                        name="price"
                        required
                        value="<%= productEdit.price %>" 
                    />
                    <% if (locals.errors && errors.price) { %>
                        <p class="errors"><%= errors.price.msg %></p>
                    <% } %>
                    <!-- <label for="stock"><b>Stock:</b></label>
                    <input class="inputForm" 
                        type="number"
                        id="stock" 
                        name="stock"
                        required
                        value="<%= productEdit.stock %>" 
                    /> -->
                    <% if (locals.errors && errors.stock) { %>
                        <p class="errors"><%= errors.stock.msg %></p>
                    <% } %>
                </span>
                <button class="button" type="submit">Editar</button>
                </form>
            
            </div>
        <script src="\scripts\ntc.js"></script>
        <script src="\scripts\colorValidator.js"></script>
        <script src="\scripts\productEdit.js"></script>
        <script src="\scripts\imageUpload.js"></script>
    </main>
    <%- include('../partials/footer.ejs') %>
</body>
</html>